#! /bin/sh
#
# Create and start (run) a container.
#
# The container will be privileged and share the host network.
#
# Author: Kaj Munhoz Arfvidsson

. "$(dirname "$0")/config.sh"

CMD="docker run"
ARGS="$@"
ARGS="$@"

# Default docker arguments
if isempty ARGS; then
    ARGS="--name $CONTAINER_NAME"
fi

# Other docker arguments
# Default docker arguments
if isempty ARGS; then
    ARGS="--name $CONTAINER_NAME"
fi

# Other docker arguments
append ARGS \
    -it \
<<<<<<< HEAD
    -p 2222:22 \
    -p "8765:8765" \
    -v "$SHARED_VOLUME" \
    -e "TERM=xterm-256color" \
    --rm

# Enable device access for non-dev / non-macOS hosts
if ! (istrue DEV || is_darwin); then
    append ARGS \
        -v "/dev:/dev" \
        --privileged
fi

# Image to run
append ARGS \
    "$IMAGE_TAG"

# Debug command with DEBUG=1
call $CMD $ARGS
=======
    -v "$SHARED_VOLUME" \
    -v "$SHARED_VOLUME" \
    -e "TERM=xterm-256color" \
    --rm \

if istrue DEV; then
    append ARGS \
        -p "8765:8765"
else
    # On macOS, reduce privileges to avoid Docker Desktop issues
    if is_darwin; then
        append ARGS \
<<<<<<< HEAD
            --privileged \
            --network host
    else
        append ARGS \
            -v "/dev:/dev" \
            --network host \
            --privileged
    fi
=======
            -p "11311:11311" \
            -p "8080:8080" \
            -p "9090:9090"
else
    append ARGS \
        -v "/dev:/dev" \
        --network host \
        --privileged
>>>>>>> e34f9a7 (mac compatibility)
fi

append ARGS \
    "$IMAGE_TAG"

# Can be debugged with DEBUG=1 env var
call $CMD $ARGS
>>>>>>> ecc9d3f (Migration to ROS 2 (#55))
