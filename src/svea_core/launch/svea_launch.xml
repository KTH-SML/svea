<?xml version="1.0"?>
<launch>
    <!-- Launch file arguments -->
    <arg name="map"             default="floor2"/>
    <arg name="is_sim"          default="true"/>
    <let name="is_sim" value="$(eval '\'$(var is_sim)\' == \'true\'')"/>
    <arg name="use_foxglove"    default="true"/>
    <let name="use_foxglove" value="$(eval '\'$(var use_foxglove)\' == \'true\'')"/>
    <arg name="initial_pose_x"  default="-2.65488696"/>
    <arg name="initial_pose_y"  default="-1.64422277"/>
    <arg name="initial_pose_a"  default="1.57" /> <!-- wrt to map-->
    <arg name="state" default="[-7.4, -15.3, 0.9, 0.0]" />
    <arg name="vehicle_name" default=""/>


    <group if="$(var is_sim)">
        <!-- Start transforms -->
        <include file="$(find-pkg-share svea_localization)/launch/transforms.xml">
            <arg name="is_indoors" value="$(var is_sim)"/>
            <arg name="vehicle_name" value="$(var vehicle_name)"/>
        </include>
        
        <!-- Start simulation -->
        <include file="$(find-pkg-share svea_core)/launch/simulation.xml">
            <arg name="state" value="$(var state)" />
            <arg name="map" value="$(var map)" />
        </include>
    </group>

    <!-- If is_sim equal to false, then include all these tags-->
    <group unless="$(var is_sim)">
        <!-- Start low-level interface -->
        <executable cmd="$(find-pkg-share svea_core)/util/start_micro_ros.sh" output="screen"/>

        <!-- Start localization -->
        <include file="$(find-pkg-share svea_localization)/launch/localize.xml">
            <arg name="initial_pose_x" value="$(var initial_pose_x)" />
            <arg name="initial_pose_y" value="$(var initial_pose_y)" />
            <arg name="initial_pose_a" value="$(var initial_pose_a)" />
        </include>

        <!--LLI fixers-->
        <node pkg="svea_core" exec="encoder_filter.py" name="encoder_filter" output="screen"/>
        <node pkg="svea_core" exec="imu_bias_remover.py" name="imu_bias_remover" output="screen"/>
    </group>


    <!-- Start loading svea model -->
    <include file="$(find-pkg-share svea_core)/launch/svea_vizualization.launch.py">
        <arg name="vehicle_name" value="$(var vehicle_name)"/>
    </include>

</launch>
